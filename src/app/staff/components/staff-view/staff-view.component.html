<div class="container-full">
    <form [formGroup]="baseForm" class="">
        <div class="row px-2 align-item-center pt-2" *ngIf="!doctor">
            <div class="col-lg-8 col-12 d-flex flex-lg-row flex-column justify-content-sm-start">
                <div class="d-flex align-item-lg-center align-item-start justify-content-start"
                    style="align-items: center;">
                    <span>
                        <!-- routerLink="/staff/main" -->
                        <button class="border-0 bg-transparent p-0" (click)="navigateBack()">
                            <i class="ri-arrow-left-line fs-4 td-color"></i>
                        </button>
                    </span>
                    <span class="fs-4 ps-2">{{staff?.name || ""}}</span>
                    <span class="td-color fw-light ps-2">( Joined {{ timeSrvc.calculateDaysBack(staff?.added_on) }} )</span>
                </div>

            </div>

            <div class="col-lg-4 col-12 d-flex justify-content-end">
                <div class="row">
                    <div class="col-6">
                        <button class="btn btn-success rounded-3 px-lg-5" (click)="saveStaff()" [disabled]="inProgress">
                            <div class="d-flex flex-row align-items-center justify-content-center gap-2" *ngIf="inProgress">
                                <span class="spinner-border spinner-border-sm mr-1 "></span>
                            </div>
                            <span *ngIf="!inProgress">Update</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-2 justify-content-between">

            <!-- STAFF DETAILS SECTION  -->
            <div class="col-lg-6 col-12 p-3" *ngIf="!doctor">
                <div class="row border rounded-3 bg-white">
                    <div class="col-12 pt-2 tabsNavigation d-flex">
                        <form [formGroup]="baseForm" class="">
                            <div class="container-full pt-2 pb-3 px-3">

                                <div class="row">
                                    <div class="col-12">

                                        <div class="row mb-3 ">
                                            <div class="col-12 fs-5 fw-light td-color border-bottom pb-2">
                                                Personal & Contact Details
                                            </div>
                                        </div>

                                        <!-- staff name , gender, title  -->
                                        <div class="row mb-3">
                                            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
                                                <div class="row">
                                                    <div class="col-12">
                                                        <span>Staff Name & Gender <span
                                                                style="color:red">*</span></span>
                                                    </div>
                                                    <div class="col-12">
                                                        <div class="row g-0">

                                                            <!-- PATIENT NAME INPUT  -->
                                                            <div class="col-8">
                                                                <app-input [formSubmitted]="submitted"
                                                                    formControlName="name" [applyAutoFocus]="true"
                                                                    classVal="form-control rounded-0 rounded-start fw-light"
                                                                    requiredMessage="Enter name" [spellcheck]="false"
                                                                    (onValueChanged)="formatString($event, 'name')"
                                                                    [removeLabel]="true" placeHolder="Enter name"
                                                                    [inputValue]="baseForm.value.name"></app-input>
                                                            </div>

                                                            <!-- GENDER SELECT  -->
                                                            <div class="col-2">
                                                                <select formControlName="gender"
                                                                    aria-label="gender input with select button"
                                                                    id="gender"
                                                                    class="form-select bg-soft-primary rounded-0 rounded-end"
                                                                    (change)="changeGender($event)"
                                                                    aria-label="Text input with select button">
                                                                    <option disabled>
                                                                        <small> Select gender</small>
                                                                    </option>
                                                                    <ng-container *ngFor="let gender of genders">
                                                                        <option [value]="gender.id"
                                                                            *ngIf="gender.is_active"
                                                                            [selected]="baseForm.value.gender === gender.name">
                                                                            {{gender.name}}</option>
                                                                    </ng-container>
                                                                </select>
                                                                <!-- <div *ngIf="baseForm.get('gender')!.invalid" class="text-danger">
                                                    Gender is required
                                                </div> -->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>


                                        <!-- mobile number and email address  -->
                                        <div class="row g-2">

                                            <div class="col-lg-3 col-6">
                                                <!-- MOBILE NUMBER  -->
                                                <div class="row mb-3">
                                                    <div class="col-12">Mobile Number <span class="text-danger">*</span>
                                                    </div>
                                                    <div class="col-12">
                                                        <app-input [inputLength]="10" [formSubmitted]="submitted"
                                                            formControlName="mobile_number" [removeLabel]="true"
                                                            placeHolder="Enter Number"
                                                            [applyAllowNumbersOnly]="true"></app-input>

                                                    </div>
                                                </div>
                                            </div>


                                            <div class="col-lg-3 col-6">
                                                <div class="row">
                                                    <div class="col-12">Date of Birth </div>
                                                    <div class="col-12">
                                                        <app-datepicker formControlName="date_of_birth"
                                                            datePickerFormat="Y-m-d"
                                                            placeHolder="Select DOB"></app-datepicker>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-lg-6 col-12">
                                                <!-- EMAIL  -->
                                                <div class="row">
                                                    <div class="col-12">Email </div>
                                                    <div class="col-12">
                                                        <app-input [formSubmitted]="submitted"
                                                            formControlName="email" [removeLabel]="true"
                                                            placeHolder="Enter Email Address"></app-input>
                                                    </div>
                                                </div>
                                            </div>


                                        </div>

                                        <!-- email  -->
                                        <div class="row mb-3" *ngIf="false">
                                            <div class="col-12">
                                                <div class="col-6">
                                                    <!-- EMAIL  -->
                                                    <div class="row">
                                                        <div class="col-12">Email </div>
                                                        <div class="col-12">
                                                            <app-input [formSubmitted]="submitted"
                                                                formControlName="email" [removeLabel]="true"
                                                                placeHolder="Enter Email Address"></app-input>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>


                                        <div class="row mb-3">
                                            <div class="col-lg-6">
                                                <ng-container *ngTemplateOutlet="profilePictureComp"></ng-container>
                                            </div>
                                            <div class="col-lg-6">
                                                <ng-container *ngTemplateOutlet="signatureComp"></ng-container>
                                            </div>
                                        </div>

                                        <ng-template #profilePictureComp>
                                            <!-- profile pciture -->
                                            <div class="row align-items-end mb-3">
                                                <div class="col-12">
                                                    Profile Picture
                                                </div>
                                                <div class="col-12">
                                                    <div class="row g-2">
                                                        <div class="col-12 fw-light" *ngIf="!baseForm.value.profile_pic">
                                                            <input name="logo" type="file" class="form-control"
                                                                accept="image/png, image/gif, image/jpeg"
                                                                (change)="ProfileChanged($event)">
                                                            <small>Maximum Width 5000px, Maxium Height 5000px</small>
                                                        </div>
                                                        <div class="col-5">
                                                            <button name="removeBtn" *ngIf="baseForm.value.profile_pic"
                                                                (click)="openXl(viewImage, baseForm.value.profile_pic, 'Profile Picture')"
                                                                class="btn btn-soft-primary w-100 border-primary rounded-3">View</button>
                                                        </div>
                                                        <div class="col-5">
                                                            <button name="removeBtn" *ngIf="baseForm.value.profile_pic"
                                                                (click)="clearLogo(false)"
                                                                class="btn btn-soft-danger w-100 border-danger rounded-3">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </ng-template>

                                        <ng-template #signatureComp>
                                            <!-- signature -->
                                            <div class="row align-items-end mb-3">
                                                <div class="col-12">
                                                    Signature
                                                </div>
                                                <div class="col-12">
                                                    <div class="row g-2">
                                                        <div class="col-12 fw-light" *ngIf="!baseForm.value.signature">
                                                            <input name="logo" type="file" class="form-control"
                                                                accept="image/png, image/gif, image/jpeg"
                                                                (change)="onFileChanged($event)">
                                                            <small>Maximum Width 500px, Maxium Height 500px</small>
                                                        </div>
                                                        <div class="col-5">
                                                            <button name="removeBtn" *ngIf="baseForm.value.signature"
                                                                (click)="openXl(viewImage, baseForm.value.signature, 'Signature')"
                                                                class="btn btn-soft-primary w-100 border-primary rounded-3">View</button>
                                                        </div>
                                                        <div class="col-5">
                                                            <button name="removeBtn" *ngIf="baseForm.value.signature"
                                                                (click)="clearLogo(true)"
                                                                class="btn btn-soft-danger w-100 border-danger rounded-3">Remove</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </ng-template>


                                        <div class="row mb-3">
                                            <div class="col-12 fs-5 fw-light td-color border-bottom pb-2">
                                                Job Details
                                            </div>
                                        </div>

                                        <!-- role, department  -->
                                        <div class="row g-2">

                                            <div class="col-7">
                                                <div class="row mb-3">
                                                    <div class="col-12">
                                                        Role <span class="text-danger">*</span>
                                                    </div>
                                                    <div class="col-12">
                                                        <app-select [selectItems]="roles" [selectBindLabel]="'name'" 
                                                        (onSelectionChanged)="changeRole()"
                                                        formControlName="role"
                                                        [formSubmitted]="submitted"
                                                        placeHolder="Select Role" ></app-select>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-5">
                                                <div class="col-12">Department </div>
                                                <div class="col-12">
                                                    <app-select formControlName="department" [selectItems]="departments"
                                                        [selectBindLabel]="'name'"
                                                        placeHolder="Select Department"></app-select>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- employment type, branch  -->
                                        <div class="row mb-3 g-2">
                                            <div class="col-6">
                                                <div class="col-12">Employment type </div>
                                                <div class="col-12">
                                                    <app-select formControlName="employement_type"
                                                        [selectItems]="employmentTypes" [selectBindLabel]="'name'"
                                                        placeHolder="Select Employment type"></app-select>
                                                </div>
                                            </div>

                                            <div class="col-6" *ngIf="false">
                                                <div class="col-12">Branch </div>
                                                <div class="col-12">
                                                    <app-select formControlName="branch" [selectItems]="branches"
                                                        [selectBindLabel]="'name'"
                                                        placeHolder="Select Branch"></app-select>
                                                </div>
                                            </div>

                                            <div class="col-6">
                                                <div class="row mb-3">
                                                    <div class="col-12">Shift </div>
                                                        <div class="col-12">
                                                            <app-select formControlName="shift" [selectItems]="shifts"
                                                                [selectBindLabel]="'name'"
                                                                placeHolder="Select Shift"></app-select>
                                                        </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row mb-3" *ngIf="false">

                                            <div class="col-5">
                                                <div class="col-12">Shift </div>
                                                <div class="col-12">
                                                    <app-select formControlName="shift" [selectItems]="shifts"
                                                        [selectBindLabel]="'name'"
                                                        placeHolder="Select Shift"></app-select>
                                                </div>
                                            </div>
                                        </div>


                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <div class="row mb-3 ">
                                                    <div class="col-12 fs-5 fw-light td-color border-bottom pb-2">
                                                        Access Details
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-12">
                                                        <ng-container *ngTemplateOutlet="labMenusTable"></ng-container>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- HOURLY RATE  -->
                                        <!-- <div class="row mb-3">
                                                <div class="col-12">Hourly Rate <span class="text-danger">*</span></div>
                                                <div class="col-12">
                                                    <app-input [formSubmitted]="submitted" [removeLabel]="true" placeHolder="Enter Hourly rate" [applyAllowNumbersOnly]="true"></app-input>
                                                </div>
                                            </div> -->
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                </div>
            </div>


            <!-- NOTES OF THE STAFF  -->
            <div [class.col-lg-6]="!doctor" [class.p-3]="!doctor" class="col-12">
                <div class="row p-2 mb-3 border rounded-3 bg-white">
                    <div class="col-12">
                        <div class="row">
                            <div class="col-12 d-flex justify-content-between lign-items-center">
                                <ul ngbNav #nav="ngbNav" class="nav-tabs-custom-transparent d-flex align-items-center">
                                    <li ngbNavItem>
                                      <button ngbNavLink class="fs-5">Recent Activity</button>
                                      <ng-template ngbNavContent>
                                        <ng-container *ngTemplateOutlet="activityLogsContainer"></ng-container>
                                      </ng-template>
                                    </li>

                                    <li ngbNavItem *ngIf="doctor">
                                        <button ngbNavLink class="fs-5">Menus</button>
                                        <ng-template ngbNavContent>
                                          <div class="pt-3">
                                            <ng-container *ngTemplateOutlet="labMenusTable"></ng-container>
                                          </div>
                                        </ng-template>
                                      </li>

                                    <li ngbNavItem >
                                      <button ngbNavLink class="fs-5">
                                        {{doctor ? 'Permissions' : 'User Permissions'}}
                                      </button>
                                      <ng-template ngbNavContent>
                                        <ng-container *ngTemplateOutlet="userPermissionsContainer"></ng-container>
                                      </ng-template>
                                    </li>

                                    <li ngbNavItem >
                                        <button ngbNavLink class="fs-5">Branch</button>
                                        <ng-template ngbNavContent>
                                            <!-- branch -->
                                            <div class="row pt-3" *ngIf="organization">
                                                <div class="col-12">
                                                    <app-datatable>
                                                        <ng-container class="tableheader">
                                                            <th>
                                                                <app-checkbox [showLabel]="false" activeText="" inactiveText="" classVal="" labelClass="d-none" [inputDisabled]="is_superadmin()"
                                                                (onCheckboxValueChanged)="selectAllBranches($event)" [checkboxValue]="( organization?.addresses && selectedBranches.length == organization?.addresses.length )|| is_superadmin()"></app-checkbox>
                                                            </th>
                                                            <th>Branch</th>
                                                        </ng-container>
                                                        <ng-container class="tablebody">
                                                            <tr *ngFor="let item of organization.addresses">
                                                                <td class="py-1">
                                                                    <app-checkbox [showLabel]="false" activeText="" inactiveText="" [checkboxValue]="is_branched(item.id) || is_superadmin()" [inputDisabled]="is_superadmin()"
                                                                        (onCheckboxValueChanged)="addOrRemoveBranches($event, item.id)" classVal=""></app-checkbox>
                                                                </td>
                                                                <td>{{item.address}}</td>
                                                            </tr>

                                                        </ng-container>
                                                    </app-datatable>
                                                </div>
                                            </div>
                                        </ng-template>
                                     </li>


                                </ul>

                                <div class="fs-5 pe-3">
                                    <app-checkbox [showLabel]="false" inactiveText="Login" labelClass="fw-medium" 
                                    (onCheckboxValueChanged)="toggleLogin_access('can_login', $event)"
                                    [inputDisabled]="is_superadmin()"
                                    activeText="Login" [checkboxValue]="baseForm.get('can_login')?.value"
                                    ngbTooltip="{{is_superadmin() ? 'Can`t Disable Super Admin Access. Kindly Change the role and try again.' : ''}}"></app-checkbox>
                                  </div>
                            </div>

                            <div class="col-12">
                                <div [ngbNavOutlet]="nav"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </form>
</div>






<ng-template #viewImage let-modal>
    <app-view-image [image]="picture" title="{{title}}"></app-view-image>
</ng-template>

<ng-template #activityLogsContainer>
    <div class="row">
                                               
        <div class="col-12 mb-3 pt-2">
            <div class="row">

                    <div class="col-5 btn-group d-flex gap-2" role="group" aria-label="Basic example">
                        <button type="button" class="btn rounded-3" [class.btn-primary]="activeButton == 'POST'" 
                        [class.bg-light-blue]="activeButton != 'POST'" (click)="changeActivitySettings('POST')">Created</button>
                        
                        <button type="button" class="btn rounded-3" [class.btn-primary]="activeButton == 'PUT'" 
                        [class.bg-light-blue]="activeButton != 'PUT'" (click)="changeActivitySettings('PUT')">Changed</button>
                        
                        <!-- <button type="button" class="btn rounded-3" [class.btn-primary]="activeButton == 'GET'" 
                        [class.bg-light-blue]="activeButton != 'GET'" (click)="changeActivitySettings('GET')">View</button> -->
                      </div>
                      
                      <div class="col-5">
                        <app-datepicker-section (dateRangeSelected)="getRangeValue($event)" [selectToday]="true"></app-datepicker-section>
                      </div>

                      <div class="col-2">
                        <select (change)="changePageSize($event)" class="form-select rounded-3">
                            <option selected [value]="25">25</option>
                            <option [value]="50">50</option>
                            <option [value]="75">75</option>
                            <option [value]="100">100</option>
                            <option [value]="150">150</option>
                            <option [value]="200">200</option>
                            <option [value]="200">250</option>
                            <option [value]="200">300</option>
                        </select>
                      </div>
                      <!-- <div class="col-2 btn-group d-flex gap-1" role="group" aria-label="Basic example">
                        <button type="button" class="btn rounded-3" [class.btn-primary]="activeButton == 'POST'" 
                        [class.bg-light-blue]="activeButton != 'POST'" (click)="changeActivitySettings('POST')">
                        <i class="ri-arrow-left-line"></i>
                    </button>
                        <button type="button" class="btn rounded-3" [class.btn-primary]="activeButton == 'PUT'" 
                        [class.bg-light-blue]="activeButton != 'PUT'" (click)="changeActivitySettings('PUT')">
                        <i class="ri-arrow-right-line"></i>
                    </button>
                       </div> -->
                <!-- </div> -->
            </div>
        </div>

    
        <!-- activity logs  -->

        <div class="col-12">
            <div class="container-full p-0" style=" height: 157vh;overflow: scroll;">
                <ul class="timeline" *ngFor="let item of logs" >
                    <li (dblclick)="item.patient ? showPatient(item.patient) : ''" ngbTooltip="{{item?.patient ? 'Open Patient' : ''}}" class="cursor-pointer">
                        <!-- begin timeline-time -->
                        <div class="timeline-time" style="padding-top: 5px !important;">
                            <span class="date text-nowrap fw-light">
                                <small>{{timeSrvc.dateAsString(item.timestamp, true, true)}}</small>
                            </span>                              
                            <span class="time fw-medium fs-6">
                                <ng-container *ngIf="item.operation == 'GET'">
                                    View
                                </ng-container>
                                <ng-container *ngIf="item.operation == 'POST'">
                                    {{extractKeywords(item.activity)}}
                                </ng-container>
                                <ng-container *ngIf="item.operation == 'PUT'">
                                    Changed
                                </ng-container>
                            </span>
                        </div>
                        <!-- end timeline-time -->
                        <!-- begin timeline-icon -->
                        <div class="timeline-icon">
                            <a href="javascript:;">
                                <i class="ri-check-line"></i>
                            </a>
                        </div>
                        <!-- end timeline-icon -->
                        <!-- begin timeline-body -->
                        <div class="timeline-body p-0 rounded-3 ">
                            <div class="timeline-header py-2 d-flex flex-column" style="padding-top: 16px !important;">
                            <ng-container *ngIf="item.operation == 'GET' || item.operation == 'POST'">
                                <span><span class="fw-light pt-3 logoColor">{{removeTimeZone(item.activity)}}</span></span>
                            </ng-container>

                            <ng-container *ngIf="item.operation == 'PUT'">

                                <span class="logoColor fw-medium">{{extractLastWord(item.url)}}</span>
    
                                <ng-container *ngFor="let activity of item.changes">
                                    
                                    <ul class="d-flex flex-column fw-light">
                                      <li class="d-flex flex-row align-items-center flex-wrap gap-1">Changed <span class="fw-semibold">{{ transformFieldName(activity.field_name) }}</span> 
                                        from 
                                        <span class="fw-semibold">
                                            <ng-container *ngIf="!isHtml(activity.before_value) else beforeVal">
                                                {{ activity.before_value }}
                                            </ng-container>
                                            <ng-template #beforeVal>
                                                <button class="btn rounded-3 btn-primary" (click)="insertPdf(htmlReport, activity.before_value)">View</button>
                                            </ng-template>
                                        </span>
                                        <span>
                                            <i class="ri-arrow-right-line"></i>
                                        </span> 
                                        <span class="fw-semibold">
                                            
                                            <ng-container *ngIf="!isHtml(activity.after_value) else afterVal">
                                                {{ activity.after_value }}
                                            </ng-container>
                                            <ng-template #afterVal>
                                                <button class="btn rounded-3 btn-primary" 
                                                (click)="insertPdf(htmlReport, activity.after_value)">View</button>
                                            </ng-template>

                                        </span>
                                    </li>
                                    </ul>
                                  </ng-container>
                                  
                                  
                            </ng-container>
                              
                            </div>
                            <div class="timeline-content rounded-3 ">
                                <span></span>
                            </div>

                        </div>
                        <!-- end timeline-body -->
                    </li>


                </ul>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #labMenusTable>
    <app-datatable>
        <ng-container class="tableheader">
            <th>Section</th>
            <th>
                <div class="d-flex flex-row">
                    <app-checkbox
                        [ngbTooltip]="is_superadmin() ? 'Super Admin has access to all sections' : !selectAll ? 'Select All Permissons' : 'Remove All Permissions'"
                        (onCheckboxValueChanged)="selectAllPermissions()" [inputDisabled]="is_superadmin()"
                        classVal="" [checkboxValue]="selectAll || is_superadmin()"
                        activeText="" inactiveText=""
                        [showLabel]="false"></app-checkbox>
                    Action
                </div>
            </th>
        </ng-container>

        <ng-container class="tablebody">
            <tr *ngFor="let item of menusList">
                <td class="py-1 fs-5 fw-medium">
                    {{item.label}}
                </td>
                <td>
                    <app-checkbox activeText="" inactiveText=""
                        (onCheckboxValueChanged)="addRemoveCheck($event, item.id)"
                        [checkboxValue]="accessList && accessList.includes(item.id)" placement="left"
                        classVal="" [inputDisabled]="is_superadmin()" [ngbTooltip]="is_superadmin() ? 'Accessible since the user is a superadmin' : accessList && accessList.includes(item.id) ? item.label + ' access given' : 'Give ' + item.label + ' access'"
                        [showLabel]="false"></app-checkbox>
                </td>
            </tr>
        </ng-container>
    </app-datatable>
</ng-template>

<ng-template #userPermissionsContainer>
    <div class="row pt-3 ">
        <div class="col-12">
            <div class="row">
                <div class="col-12">
                    <app-datatable>
                        <ng-container class="tableheader">
                            <th>
                                <!-- Section -->
                                Patient's Section Permissions
                            </th>
                            <th>
                                <div class="d-flex flex-row">
                                    <app-checkbox
                                       
                                        (onCheckboxValueChanged)="checkAllUserPermissions($event)"
                                        classVal=""  [checkboxValue]="(user_permissions && checkedAll()) || is_superadmin() "
                                        activeText="" inactiveText=""
                                        [ngbTooltip]="is_superadmin() ? 'Super Admin has all the permissions' : 'Select All'"
                                        [inputDisabled]="is_superadmin()"
                                        [showLabel]="false"></app-checkbox>
                                    Action
                                </div>
                            </th>
                        </ng-container>

                        <ng-container class="tablebody"  *ngFor="let item of patients_page_permissions">
                            <tr>
                                <td class="py-1 fs-5 fw-medium">
                                    {{ item.name }}
                                </td>
                                <td>
                                    <div class="d-flex gap-2 align-items-center">
                                        <app-checkbox 
                                        [checkboxValue]="(user_permissions && user_permissions?.permissions?.includes(item.id)) || is_superadmin()"
                                          activeText="" 
                                          inactiveText=""
                                          classVal=""
                                          [ngbTooltip]="is_superadmin() ? 'Super Admin has all the permissions' : ''"
                                          [inputDisabled]="is_superadmin()"
                                          (onCheckboxValueChanged)="addRemoveCheckUserPermissions($event, item.id)"
                                          [showLabel]="false"></app-checkbox>
                                    </div>
                                  </td>
                        
                            </tr>

                            <tr class="bg-light-blue" *ngIf="item.name == 'Discount' && user_permissions && (user_permissions?.permissions?.includes(item.id) || is_superadmin())">

                                <td colspan="2" >
                                    <div ngbTooltip="Enter the maximum percentage of discount that this user can provide to the patient on the total price of the tests." 
                                    class="d-flex flex-row align-items-center justify-content-center gap-2" >
                                        <div>
                                            <small class="text-muted" >Enter Discount Limit</small>
                                        </div>
                                        <div class="w-25">
                                            <input [disabled]="is_superadmin()" class="form-control fw-bold rounded-3 shadow" (input)="enterDiscount($event)" [value]="is_superadmin() ? 100 : user_permissions.number">
                                        </div>
                                        <span class="fw-bold fs-5">%</span>
                                    </div>
                                </td>
                               
                            </tr>
                        
                        </ng-container>
                    </app-datatable>
                </div>
            </div>



            <div class="row pt-3 ">
                <div class="col-12">
                    <div class="row">

                        <div class="col-12 mb-3">

                            
                            <app-datatable>
                                <ng-container class="tableheader">
                                    <th>
                                        <!-- Section -->
                                        Lab Technician's Section Permissions
                                    </th>
                                    <th>
                                        <div class="d-flex flex-row">
                                            <!-- <app-checkbox
                                                (onCheckboxValueChanged)="checkAllUserPermissions($event)"
                                                classVal="" [checkboxValue]="permissions && permissions.length == 11 "
                                                activeText="" inactiveText=""
                                                [showLabel]="false"></app-checkbox> -->
                                            Action
                                        </div>
                                    </th>
                                </ng-container>

                                <ng-container class="tablebody"  *ngFor="let item of lab_tech_permissions">
                                    <tr>
                                        <td class="py-1 fs-5 fw-medium">
                                            {{ item.name }}
                                        </td>
                                        <td>
                                            <div class="d-flex gap-2 align-items-center">
                                                <app-checkbox 
                                                [checkboxValue]="(user_permissions && user_permissions?.permissions?.includes(item.id)) || is_superadmin()"
                                                  activeText="" 
                                                  inactiveText=""
                                                  [inputDisabled]="is_superadmin()"
                                                  classVal=""
                                                  (onCheckboxValueChanged)="addRemoveCheckUserPermissions($event, item.id)"
                                                  [showLabel]="false"></app-checkbox>
                                            </div>
                                          </td>
                                    </tr>
                                
                                </ng-container>
                            </app-datatable>
                        </div>



                        <div class="col-12 mb-3">

                            
                            <app-datatable>
                                <ng-container class="tableheader">
                                    <th>
                                        <!-- Section -->
                                        Transcriptor's Section Permissions
                                    </th>
                                    <th>
                                        <div class="d-flex flex-row">
                                            <!-- <app-checkbox
                                                (onCheckboxValueChanged)="checkAllUserPermissions($event)"
                                                classVal="" [checkboxValue]="permissions && permissions.length == 11 "
                                                activeText="" inactiveText=""
                                                [showLabel]="false"></app-checkbox> -->
                                            Action
                                        </div>
                                    </th>
                                </ng-container>

                                <ng-container class="tablebody"  *ngFor="let item of radio_permissions">
                                    <tr>
                                        <td class="py-1 fs-5 fw-medium">
                                            {{ item.name }}
                                        </td>
                                        <td>
                                            <div class="d-flex gap-2 align-items-center">
                                                <app-checkbox 
                                                [checkboxValue]="(user_permissions && user_permissions?.permissions?.includes(item.id)) || is_superadmin()"
                                                  activeText="" 
                                                  inactiveText=""
                                                  classVal=""
                                                  [inputDisabled]="is_superadmin()"
                                                  (onCheckboxValueChanged)="addRemoveCheckUserPermissions($event, item.id)"
                                                  [showLabel]="false"></app-checkbox>
                                            </div>
                                          </td>
                                    </tr>
                                
                                </ng-container>
                            </app-datatable>
                        </div>
                    </div>
                </div>
            </div>



        </div>
    </div>
</ng-template>


<ng-template #htmlReport let-modal>
    <div class="modal-header py-2 px-3 modal-bg d-flex justify-content-between align-items-center">
        <span class="modal-title fs-4 " id="modal-basic-title"></span>
        <div>

            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
        </div>
    </div>
    <div class="modal-body rounded-3 modal-bg">
        <div class="container-full">
            <div class="row">
                <div class="col-1">
                    <button (click)="copyText()"  ngbTooltip="Copy HTML(Source Code)">
                        <i class="ri-clipboard-line"></i>
                    </button>
                </div>
                <div class="col-11 d-flex justify-content-center" id="report">
                    <iframe id="disbaled_iframe" style="width: 221mm; margin: 0 auto; height: 75vh"></iframe>
                </div>
            </div>
        </div>
    </div>
</ng-template>