<div class="container-full py-2 px-3" style="min-height: 500px;">

    <!-- HEADING  -->
    <div class="row mb-3 g-3 justify-content-between">
        <div class="col-lg-6 col-12">
            <div class="row border-5 border-start border-primary rounded-2 ps-2">
                <div class="col-12">
                    <span class="fw-medium fs-5">Packages</span>
                </div>
                <div class="col-12">
                    <span class="text-wrap td-color">Turn on/off essential features required for Packages</span>
                </div>
            </div>
        </div>

        <div class="col-lg-6 col-12 d-flex justify-content-lg-end justify-content-start">
            <app-addnewbutton (onAddNewClick)="openPackage(null, addUpdate)"
             buttonText="Add Package" content="content"></app-addnewbutton>
        </div>
    </div>

    <!-- search box  -->
    <div class="row g-2 mb-3 justify-content-between">
        <div class="col-lg-8 col-12">
            <div class="row g-2">
                <div class="col-5">
                    <app-searchbox placeholder="Search Packages" [spellcheck]="false" [applyAutoFocus]="false"
                        (searchTermChange)="searchQuery($event)" [searchTerm]="query"></app-searchbox>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-12 d-flex justify-content-lg-end justify-content-start align-items-center">
            <div class="row">
                <div class="col-4">
                    <span class="fw-light">Showing</span>
                </div>
            </div>
            <div class="col-4 px-1">
                <select class="form-select form-select-sm rounded-3 fw-medium fs-6 w-100 font-DMSans"
                    style="width: auto" name="pageSize" placeholder="Select" (change)="changePageNumber($event)">
                    <option value="10">10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option [value]="all_count">All</option>
                </select>
            </div>
            <div class="col-3">
                <span class="fw-light">Entries</span>
            </div>

        </div>

    </div>

    
  <div class="row mb-2">
    <div class="col-12">
      <app-datatable>
        <ng-container class="tableheader">
          <th style="width:10px">S.no</th>
          <th>Name</th>
          <th>Total Tests</th>
          <th>Offer Price</th>
          <th>Total Amount</th>
          <th>Discount</th>
          <th>Active</th>
        </ng-container>

        <ng-container class="tablebody">
          <tr *ngFor="let package of global_packages; let i=index" style="min-height: 32px;">
            <td class="text-black text-nowrap fs-5 fw-medium">{{ (page_number * page_size) - page_size + i + 1 }}.</td>
            <td class="text-black text-nowrap fs-5 fw-medium py-2" (click)="openPackage(package, addUpdate)">
              {{package.name}}</td>
            <td (click)="openPackage(package, addUpdate)">
              <div 
              class="d-flex flex-row justify-content-between align-items-center" style="max-width: 230px;">
              <div class="d-flex flex-column">
                <small class="text-truncate fw-medium text-black" style="max-width: 230px;">
                  {{concatenateShortCodes(package).name}}
                </small>
                <small>Total: {{ concatenateShortCodes(package).count }}</small>
              </div>
            </div>

            </td>
     
            <td class="text-black text-nowrap fs-6 fw-semibold" (click)="openPackage(package, addUpdate)">
              {{formatCurrency(package.offer_price)}}
            </td>

            <td class="text-black text-nowrap fs-6 fw-normal" (click)="openPackage(package, addUpdate)">
              {{formatCurrency(package.total_amount)}}
            </td>


            <td class="text-black text-nowrap fs-6 fw-normal" (click)="openPackage(package, addUpdate)">
            
              <span *ngIf="!package?.is_disc_percentage">
                {{formatCurrency(package.total_discount)}}
              </span>

              <span *ngIf="package?.is_disc_percentage">
                {{getFormatedVal(package.total_discount) + " %"}}
              </span>
            
            </td>

            <td>
              <app-checkbox [showLabel]="false" classVal="form-switch" activeText="" inactiveText=""
                [checkboxValue]="package?.is_active" (onCheckboxValueChanged)="updateIsActive(package, $event)"></app-checkbox>
            </td>
          </tr>
        </ng-container>
      </app-datatable>
    </div>
  </div>

  <!-- PAGINATION  -->
  <div class="row g-1 justify-content-md-between align-items-md-center font-DMSans">
    <div class="col col-sm-6 text-sm-right ">
      <span class="text-nowrap">Showing {{(page_number * page_size) - page_size + 1}} to {{(page_number * page_size) <
          all_count ? page_number * page_size : all_count}} of {{ all_count ? all_count : 0 }} Entries</span>
    </div>
    <div class="col col-sm-6">
      <div class="text-sm-right float-end text-black">
        <div class="d-flex">
          <ngb-pagination [collectionSize]="all_count ? all_count : 0" [(page)]="page_number" [maxSize]="3"
            (pageChange)="onPageChange($event)" [pageSize]="page_size" [rotate]="true" [boundaryLinks]="true"
            class="custom-pagination">
            <ng-template ngbPaginationPrevious class="font-DMsans">Prev</ng-template>
            <ng-template ngbPaginationNext class="font-DMSans">Next</ng-template>
          </ngb-pagination>

        </div>
      </div>
    </div>
  </div>


</div>


<ng-template #addUpdate let-modal>
    <div class="modal-header py-2 px-3 bg-light-blue border-bottom">
        <span class="modal-title fs-5" id="modal-basic-title">
            {{selected_item ? 'Update Package' : 'Add Package'}}
        </span>
        <button type="button" class="btn-close" aria-label="Close"
            (click)="modal.dismiss('Cross click');"></button>
    </div>

    <div class="modal-body">
        <app-add-packages #addPackages [package]="selected_item || null" (saved)="getData();modal.dismiss('Cross click');"></app-add-packages>
        <!-- <app-add-rooms #addRooms [room]="selected_item || null" (saved)="getData();modal.dismiss('Cross click');"></app-add-rooms> -->
    </div>

    <div class="modal-footer py-1 px-3 bg-light-blue border-top d-flex justify-content-end">
        
        <button type="button" class="btn btn-success rounded-3 fs-5" aria-label="Close"
            (click)="addPackages.saveApiCall()">Save</button>
    </div>
</ng-template>